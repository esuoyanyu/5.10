
 
Testar功耗测试板测试使用指导
1.功能概述
Testar功耗测试板（以下简称功耗测试板），有以下功能：
1、	支持6组功耗测量（每组包括：2路采样电阻+1路电源电压）
2、	支持6路可调模拟信号输出-2.0~2.0V（连接到电源反馈引脚，支持电源调整功能）
3、	支持2路任意时钟输出差分信号（0.16~600M）（目前支持一路）
4、	支持RS232串口控制
5、	支持6路上电顺序控制，控制精度20ms
6、	支持设置数据掉电保存功能
7、	支持单板温度检测 
8、	支持复位输出
9、	支持9路电平检测功能 
10、	支持分频倍频功能（暂不支持）
11、	需12V供电
12、	支持SN号码
13、	支持UART接口
14、	支持I2C接口
2.单板简介
H820SPMA单板是为配合功率测试自动化和多角测试自动化而开发的；主要功能有：6路电流、电压测量；6路电压调节；9路LVTTL输出；9路LVTTL输入；2路任意频率时钟输出（支持参考时钟输入）；一路I2C接口；
 
图1 H820SPMA原理框图
 
图2 H820SPMA实物图
 
图3 H820SPMA单板结构
H820SPMA用的连接器编码是：14230036；所以待测单板上需要配合使用编码为14230035的连接器；该扣板共有4个M3固定螺丝孔；使用配高螺柱编码：26020005； M3X6螺钉编码： 26010284；扣板下面限高7mm；

3.使用方法
   功耗测试板扣在被测板上，由底板提供12V电源，并可以通过RS232串口控制。有CBB可以直接调用如下图：
 
图4 使用示意图
 
图5 连接器信号定义图
建议大家使用功耗测试板的CBB, \\szxnas52-rd\AN_Hareware_F\04.接入集成技术开发部\接入网芯片知识资产\04.硬件开发\04.CBB\SCH\Testar_CBB
 
 
PCB设计注意事项
1、功率测量
a. 为达到高精度和低压降的兼顾，电流采样电阻选型建议：
大于20A，建议用0.5毫欧的电阻，误差1%以下；建议使用开尔文电阻99050WXP;
2A~20A，建议用1毫欧的电阻，编码：07091421；
小于2A，建议用10毫欧电阻，编码：07090990；
注意，采样电阻不可多个串联使用。

b. 采样电阻的PCB设计：
电流采样的差分线必须从采样电阻的焊盘引出，然后送到扣板连接器，不允许把差分线再连接到电源平面上；如下图，差分线引出后，换层打了2个过孔，这2个过孔不能和电源平面连接；
 
图6 检测电阻走线要求
b. 开尔文采样电阻的PCB设计：
开尔文两个大pin连接电流线，两个小pin连接采样线。
 

2、调压电路
a. 原理简介。下图中，如果没R3，则是一个标准的电源模型（LDO和开关电源）；R1和R2的比值决定了输出电压的大小；Vout=Vref /R2*(R1+R2)；要实现调压，只需要在原电源电路的基础上，增加一个电阻R3，扣板送过来的调压信号通过R3来调节电源的输出电压；
FB是高阻，输入电流为0，则R1的电流+R3的电流=R2的电流；现假设调压信号变换dV，则R3的电流变化为dV/R3，而FB电压因负反馈存在而稳定不变，即R2的电流不变，所以R1的电流变化为-dV/R3。R1上变化的电压为-dV*R1/R3，也就是Vout改变了-dV*R1/R3。调压扣板的调压信号最小改变量为1mV，则Vout的最小调压粒度为1mV*R1/R3。如果选择R1=R3，则Vout的最小调压粒度为1mV；
 
图7 调压电路设计要求

b. PCB设计要求
R3要靠近R1和R2放置，从扣板连接器过来的调压信号需要远离动态的数字信号；
4.功耗测试板软件加载(注：波特率目前为115200)
烧写方法:
 1.使用FastBoot_V1.0.exe烧写u-boot    
  2.烧写内核指令：load_sf_kernel kernel
  3.烧写根文件系统指令：load_sf_rootfs rootfs.cramfs
通常功耗测试板，已经具备了软件。不需要加载。
5.串口控制命令(注：波特率目前为115200)
状态显示
在工作状态输入命令“power show”即可显示所有的信息，如下图：

 
图8 串口显示界面图

Board Temperature：单板温度（一般比环境温度高5度）
MAC Address：MAC地址
IPV4 Address：网络IP地址
Channel Enable：模拟信号输出使能（0表示使能）
Frequence(D)： si5338（通道0）的输出频率，D代表差分输出，S代表单模输出。
Volt(V)：功耗测试的电压值
Curr(A)：功耗测试的电流值（与采样电阻相关）
Power（W）：计算出的每一路的功耗数据
Out(mV)：各个通道的参考电压。
Res(mΩ)：采样电阻的阻值。
Delay(mS)：上电顺序控制中，各个通道的延时时间
Level(0,1)：上电顺序控制中，各个通道的输出电平。0代表输出低电平；1代表输出高
电平。
Toltal power：总功耗
The compile 编译时间（软件版本）
    Command 。。 命令执行结果。


5.1时钟频率设置
1.	设置时钟频率：clk si5338 freq set 160000 0 0 0  //设置时钟频率为0.16M，改变参数即可获得其他频率 
5.2电压值设置
设置各通道电压：power vref set 0 0  //设置0通道电压为0mv；power vref set 1 200即设置1通道电压为200mv   
除了以上命令外还有相对命令：
power increase channel value
power decrease channel value
分别是在当前的数值上增加或减少多少mV；
    在调节电源电压的应用中，初始值设置为电源内部参考电源的值。
5.3上电顺序设置
   设置电源上电顺序：power on 5 0 9 0 3 0 4 1 5 1 1 1  //每两个数据为一组，1通道5ms后变为低电平0，2，3，4，5，6通道分别经过9、3、4、5、1ms后变为0 0 1 1 1 。
目前的精度为20ms
5.4外部电平检测
通过原理图查看PDET0~ PDET8引脚所对应的GPIO引脚，查得结果为：GPIO_2~ GPIO_5, GPIO_10~ GPIO_14
读取引脚的电平 power port get
 
图9 外部电平检测结果显示图

用于检测外部状态
5.5设置采样电阻值
power resistor set channel value 设置某一路的电阻值
5.6设置通道名称
power name 3V3 2V5 1V5 1V1 V5 HUA 设置6路电源的显示名称
5.7复位单板
reset 2000 1；表示立即输出1延时2000ms后输出0；
    用于复位单板；
5.8数据保存
    power  save 保存当前设置数据

5.9数据恢复
Power restore 恢复保存设置数据
增加推荐电路，管脚列表
版本修改
2013-10-21：修改root
根据对2013-09-27版本测试结果修改如下： 
4.1 功耗测试中电流检测电阻，相差10倍：电阻实际为0.001欧姆，在设置中设置为0.01欧姆，测试值才能与实际的电流相等。 ...还没有开始检测错误(已经修改)
4.2 串口波涛率为115200，一般使用习惯为9600。（尚未修改） 
4.3 SN设置时，无论密码对错都显示为fault:password is wrong!;但是用power show显示确已经修改。 OK 
4.4 Power save 时SN没有保存。 ...OK 
4.5 一开始时没有power restor 。 ...OK 

